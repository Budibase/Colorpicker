let reader,builder,parseOptions;_2cd‍.x([["default",()=>_2cd‍.o]]);_2cd‍.w("./read.js",[["default",["reader"],function(v){reader=v}]]);_2cd‍.w("./build.js",[["default",["builder"],function(v){builder=v}]]);_2cd‍.w("./options.js",[["parseOptions",["parseOptions"],function(v){parseOptions=v}]]);



const IS_ROUTIX = Symbol('IS_ROUTIX')

const createRoutix = arg => {
  if (arg[IS_ROUTIX]) return arg

  const options = parseOptions(arg)

  const { log, write, start } = options

  const build = builder(options)

  const read = reader(options, build)

  const writeTargets = Object.values(write).filter(Boolean)

  const isWriteTarget = id => writeTargets.some(x => x === id)

  const { onIdle, get } = build
  const { init, isWatchedFile, close } = read

  if (start) {
    setTimeout(() => {
      read.init().catch(err => log.error(err))
    })
  }

  return {
    [IS_ROUTIX]: true,
    options,
    start: init,
    onIdle,
    get,
    isWriteTarget,
    isWatchedFile,
    close,
  }
}

_2cd‍.d(createRoutix);
